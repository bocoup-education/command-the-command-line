<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>All about &#x60;sudo&#x60;</title>
	<link rel="stylesheet" href="../assets/style-shared.css" />
	<link rel="stylesheet" href="../assets/style-web.css" />
</head>
<body>
<main>
	<header>
		<h1><a href="..">Command the Command Line</a></h1>
	</header>
		<nav>
			<ul>
				<li>
					Part I - Introduction
					<ul>
						<li>
							<a href="../about-course">
								Ch. 1: About the course
							</a>
						</li>
						<li>
							<a href="../setup">
								Ch. 2: Setup
							</a>
						</li>
						<li>
							<a href="../vagrant">
								Ch. 3: Using Vagrant
							</a>
						</li>
						<li>
							<a href="../history">
								Ch. 4: A Brief History of Unix
							</a>
						</li>
					</ul>
				</li>
				<li>
					Part II - Getting Your Bearings
					<ul>
						<li>
							<a href="../file-system">
								Ch. 5: The File System
							</a>
						</li>
						<li>
							<a href="../command-invocation">
								Ch. 6: Command Invocation
							</a>
						</li>
						<li>
							<a href="../process-mgmt-1">
								Ch. 7: Process Management I
							</a>
						</li>
						<li>
							<a href="../sudo">
								Ch. 8: All about &#x60;sudo&#x60;
							</a>
						</li>
						<li>
							<a href="../networking">
								Ch. 9: Networking for Web Developers
							</a>
						</li>
					</ul>
				</li>
				<li>
					Part III - Improving Your Workflow
					<ul>
						<li>
							<a href="../file-mgmt">
								Ch. 10: File Management
							</a>
						</li>
						<li>
							<a href="../process-bounds">
								Ch. 11: Process Boundaries
							</a>
						</li>
						<li>
							<a href="../process-combination">
								Ch. 12: Process Combination
							</a>
						</li>
						<li>
							<a href="../scripting">
								Ch. 13: Scripting
							</a>
						</li>
						<li>
							<a href="../customization">
								Ch. 14: Customization
							</a>
						</li>
					</ul>
				</li>
				<li>
					Part IV - Managing Systems
					<ul>
						<li>
							<a href="../process-mgmt-2">
								Ch. 15: Process Management II
							</a>
						</li>
						<li>
							<a href="../users-and-groups">
								Ch. 16: Users and Groups (TODO)
							</a>
						</li>
						<li>
							<a href="../fhs">
								Ch. 17: Filesystem Hierarchy Standard
							</a>
						</li>
						<li>
							<a href="../scheduling">
								Ch. 18: Scheduling (TODO)
							</a>
						</li>
					</ul>
				</li>
			</ul>
		</nav>
	
	<article>
		<h2>Part II - Getting Your Bearings</h2>
		<h3>All about &#x60;sudo&#x60;</h3>

		<p>Hopefully as we finish chapter 2, you are feeling more comfortable following
instructions in a Unix-like environment.</p>
<p>There's one more topic that is important to understand: the <code>sudo</code> utility.</p>
<h1>Background: Users and permissions</h1>
<pre><code class="language-terminal">vm$ whoami
sally
vm$ 
</code></pre>
<p>Recall from <a href="../history">Chapter 4 - A Brief History of Unix</a> that Unix was designed as a time-sharing system.
Many people were expected to be logged in and working at the same time. The
system recognizes "users" as a way to promote privacy while still allowing
people to share files and devices.</p>
<p>The <code>whoami</code> application is one of the better-named utilities in our toolkit;
it simply displays the name of the user who invoked it.</p>
<pre><code class="language-terminal">vm$ echo $HOME
/home/sally
vm$ ls /home
larry
nancy
sally
xavier
vm$ 
</code></pre>
<p>We've already seen some evidence of this: our <code>$HOME</code> directory isn't simply
<code>/home</code>; it's a sub-directory of <code>/home</code> named <code>sally</code>. This suggests that
there might be more directories for other people.</p>
<pre><code class="language-terminal">vm$ ls /home/larry
ls: cannot open directory /home/larry: Permission denied
vm$ 
</code></pre>
<p>We don't generally have access to the <code>$HOME</code> directories that belong to other
users.</p>
<pre><code class="language-terminal">vm$ ls -o /home
total 102
drwx------ 72 larry  24576 Jul 01 10:55 larry
drwx------ 72 nancy  8374  Jul 09 10:55 nancy
drwx------ 72 sally  39827 Jul 14 10:55 sally
drwx------ 72 xavier 33432 Jul 11 10:55 xavier
vm$ 
</code></pre>
<p>All files and folders have a set of "permissions" which describe exactly which
users may interact with them, and even <em>how</em> they may interact.</p>
<p>We'll cover this in greater detail in later sections.</p>
<h1>Background: the <code>root</code> user</h1>
<p>A Unix-like system can have any number of user accounts like this. However,
there is one special user that is present on <em>all</em> Unix-like systems: the
"root" user (also known as the "superuser").</p>
<p>This is the administrative user account. It has no access control restrictions,
meaning it has the permissions to do everything with every file and every
directory. The root user's <code>HOME</code> directory is in a special location on the
file system: <code>/root</code>.</p>
<pre><code class="language-terminal">vm$ rm -rf /bin
rm: cannot remove ‘/bin/zdiff’: Permission denied
rm: cannot remove ‘/bin/findmnt’: Permission denied
rm: cannot remove ‘/bin/bzegrep’: Permission denied
rm: cannot remove ‘/bin/gzexe’: Permission denied
rm: cannot remove ‘/bin/sh.distrib’: Permission denied
rm: cannot remove ‘/bin/chgrp’: Permission denied
rm: cannot remove ‘/bin/login’: Permission denied
</code></pre>
<p>This separation is good news for when you are learning because it means you are
unable to perform many actions that would break things. Even the person who is
"in charge" of the system (that's you in these exercises and on your personal
computer) usually has a normal user account. This limits the damage that a
malicious program can do when it runs on your behalf.</p>
<h1><code>sudo</code></h1>
<pre><code class="language-terminal">vm$ whoami
sally
vm$ sudo whoami
[sudo] password for sally: &#8203;       
root
vm$ 
</code></pre>
<ul>
<li>The <code>sudo</code> utility allows us to execute single commands as the <code>root</code> user.</li>
<li>There is some disagreement about where its name comes from. Some say it is
short for "<strong>s</strong>uper <strong>u</strong>ser <strong>do</strong>." Because you may use the <code>-u</code> option to
execute a command as <em>any</em> user, some argue that it is short for "<strong>s</strong>witch
<strong>u</strong>ser and <strong>do</strong>."</li>
</ul>
<pre><code class="language-terminal">vm$ whoami
untrusteduser
vm$ sudo whoami
[sudo] password for untrusteduser: &#8203;       
untrusteduser is not in the sudoers file.  This incident will be reported.
vm$ 
</code></pre>
<p>Not all users are able to use <code>sudo</code>. If you are working on a machine that you
do not own, you may need to request the necessary permissions from your system
administrator.</p>
<pre><code class="language-terminal">vm$ sudo echo "After I've authenticated once..."
[sudo] password for sally: &#8203;       
After I've authenticated once...
vm$ date
Wed Dec 31 1969 19:00:00 EST 1969
vm$ sudo echo "I stay in 'sudo mode' for a little while."
I stay in 'sudo mode' for a little while.
vm$ date
Wed Dec 31 1969 19:21:00 EST 1969
vm$ sudo echo "...but I'll need to re-authenticate every so often."
[sudo] password for sally: &#8203;       
...but I'll need to re-authenticate every so often.
vm$ 
</code></pre>
<p>Most systems are configured to "recognize" users that have recently
authenticated with <code>sudo</code>. In this state, you will still need to use <code>sudo</code> to
take actions as the root user, but you will not have to re-enter your password.
This status will expire after a short period (15 minutes by default).</p>
<h1>Using <code>sudo</code> safely</h1>
<pre><code class="language-terminal">vm$ apt-get install cowsay
E: Could not open lock file /var/lib/dpkg/lock - open (13: Permission denied)
E: Unable to lock the administration directory (/var/lib/dpkg/), are you root?
vm$ sudo apt-get install cowsay
[sudo] password for sally: &#8203;       
Reading package lists... Done
Building dependency tree
Reading state information... Done
cowsay is already the newest version.
0 upgraded, 0 newly installed, 0 to remove and 23 not upgraded.
vm$ 
</code></pre>
<p>You will need to use <code>sudo</code> when performing system administration tasks like
installing software. (In this example, we're using the APT package manager from
Ubuntu.) It's generally safe to use <code>sudo</code> with system utilities and when you
understand what the command is going to do.</p>
<h1>Avoiding "unsafe" uses of <code>sudo</code></h1>
<pre><code class="language-terminal">vm$ sudo ./script-i-found-on-the-web.sh
[sudo] password for sally:  &#8203;       
Installing a key logger... Done
Deleting all your applications... Done
vm$ 
</code></pre>
<p>However, many tutorials online contain instructions that use <code>sudo</code> unsafely.
Remember that the root user can do <em>anything</em>, so using <code>sudo</code> with an
untrusted program from the Internet may cause all sorts of problems.</p>
<pre><code class="language-terminal">vm$ sudo apt-get install the-dependency-i-need
[sudo] password for sally: &#8203;       
vm$ ./script-i-found-on-the-web.sh
Performing actions as the current (de-privileged) user
vm$ 
</code></pre>
<p>It's much better to perform the administrative actions manually and rely on the
untrusted program to do the rest. Even this is dangerous, though--the script
could still access your personal files. There is no substitute for trusting the
code you run, whether through reading the source or through having confidence
in its origins!</p>
<h1>In Review</h1>
<ul>
<li><code>whoami</code> is a utility that prints the current user's name</li>
<li>The "root" user (or "superuser") is capable of performing any task</li>
<li>The <code>sudo</code> utility allows you to execute single commands as the "root" user</li>
<li>You should trust any program you run using <code>sudo</code>!</li>
</ul>


	</article>
	<footer>
		<div class="bocoup">
			<img alt="Bocoup logo" src="../assets/bocoup.png" />
			<a href="https://bocoup.com">Bocoup</a> maintains <a href="..">
				Command the Command Line</a> as an open educational resource. To
				share your feedback, open an issue or a pull request on <a
				href="https://github.com/bocoup-education/command-the-command-line">
				the project's source code repository</a>.
		</div>
		<div class="license">
			<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
				<img alt="Creative Commons License"
					src="../assets/cc-by-sa.png" />
			</a>
			<br />
			Except where otherwise noted, content on this site is licensed under a
			<a rel="license"
				href="http://creativecommons.org/licenses/by-sa/4.0/">
				Creative Commons Attribution-ShareAlike 4.0 International License
			</a>.
		</div>
	</footer>
</main>
	<script src="../app.js" /></script>
</body>
</html>
